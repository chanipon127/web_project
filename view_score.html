<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <title>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</title>
  <style>
    body {
      font-family: sans-serif;
      line-height: 1.6;
      margin: 20px;
      background-color: #f5f5f5;
    }

    .container {
      max-width: 1200px;
      margin: auto;
      padding: 20px;
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    h1,
    h2,
    h3 {
      color: #333;
    }

    .info-section {
      background-color: #f9f9f9;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 20px;
    }

    .info-section p {
      margin: 8px 0;
    }

    pre {
      background: #eee;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      max-height: 300px;
      overflow-y: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th,
    td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
      vertical-align: top;
    }

    th {
      background-color: #4c65af;
      color: white;
      font-weight: bold;
    }

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    /* ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå feedback ‡πÉ‡∏´‡πâ‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô */
    td:last-child {
      white-space: pre-wrap;
      word-wrap: break-word;
      min-width: 300px;
      max-width: 500px;
    }

    .btn-back {
      padding: 10px 20px;
      background: #4c65af;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 20px;
      font-size: 16px;
    }

    .btn-back:hover {
      background: #3a4a8f;
    }

    .score {
      font-weight: bold;
      color: #2e7d32;
      font-size: 18px;
    }

    .status {
      font-weight: bold;
      padding: 4px 12px;
      border-radius: 4px;
      display: inline-block;
    }

    .status.checked {
      background-color: #c8e6c9;
      color: #2e7d32;
    }

    .status.unchecked {
      background-color: #ffcdd2;
      color: #c62828;
    }

    /* Loading Spinner */
    .loading {
      text-align: center;
      padding: 50px;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #4c65af;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .error-message {
      color: #c62828;
      padding: 20px;
      background-color: #ffcdd2;
      border-radius: 4px;
      margin: 20px 0;
    }

    /* Responsive */
    @media (max-width: 768px) {
      table {
        font-size: 14px;
      }

      th,
      td {
        padding: 8px;
      }

      td:last-child {
        min-width: 200px;
      }
    }

    /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô */
    .score-cell {
      text-align: center;
      font-weight: bold;
    }

    .score-ai {
      color: #1976d2;
    }

    .score-teacher {
      color: #388e3c;
    }
  </style>
</head>

<body>
  <div class="container" id="mainContainer">
    <div class="loading">
      <div class="spinner"></div>
      <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
    </div>
  </div>

  <script>
    // ========== ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API ==========
    const API_BASE_URL = 'http://127.0.0.1:8000';

    // ========== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö ==========
    function goBack() {
      // ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ô history ‡πÉ‡∏´‡πâ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö, ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏ó‡∏µ‡πà check_exam.html
      if (document.referrer) {
        window.history.back();
      } else {
        window.location.href = "check_exam.html";
      }
    }

    // ========== ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö answer_id ==========
    const urlParams = new URLSearchParams(window.location.search);
    const answerId = urlParams.get("answer_id");

    if (!answerId) {
      showError("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á");
    } else {
      loadAnswer(answerId);
    }

    function showError(title, message) {
      document.getElementById('mainContainer').innerHTML = `
        <button class="btn-back" onclick="goBack()">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        <div class="error-message">
          <h2>‚ö†Ô∏è ${title}</h2>
          <p>${message}</p>
        </div>
      `;
    }

    async function loadAnswer(answerId) {
      try {
        const res = await fetch(`${API_BASE_URL}/api/view-score/${answerId}`);

        if (!res.ok) {
          const errorData = await res.json().catch(() => null);
          throw new Error(`HTTP ${res.status}: ${errorData?.detail || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ'}`);
        }

        const data = await res.json();

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• Log ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
        console.log("=== ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å API ===");
        console.log("Data received:", data);
        console.log("description (raw):", data.description);
        console.log("teacher_scores (raw):", data.teacher_scores);

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏´‡∏•‡∏±‡∏Å
        const container = document.getElementById('mainContainer');
        container.innerHTML = `
          <button class="btn-back" onclick="goBack()">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
          <h1>üìã ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
          <div class="info-section">
            <h2>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
            <p><strong>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</strong> <span id="studentId">-</span></p>
            <p><strong>‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</strong> <span id="groupId">-</span></p>
            <p><strong>‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤:</strong> <span id="examYear">-</span></p>
            <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> <span id="status" class="status">-</span></p>
            <p><strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏° AI:</strong> <span id="totalScoreAI" class="score">0</span></p>
          </div>
          <h2>üìù ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
          <div class="info-section">
            <strong>‡∏Ç‡πâ‡∏≠ 1: ‡∏à‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏¢‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏ö‡∏ó‡∏≠‡πà‡∏≤‡∏ô</strong>
            <pre id="essayText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</pre>
            <strong style="display:block; margin-top:20px;">‡∏Ç‡πâ‡∏≠ 2: ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå/‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</strong>
            <pre id="essayAnalysis">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</pre>
          </div>
          <h3>üìä ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à</h3>
          <table>
            <thead>
              <tr>
                <th style="width: 350px;">‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à</th>
                <th class="score-cell" style="width: 100px;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô AI</th>
                <th class="score-cell" style="width: 100px;">‡∏Ñ‡∏£‡∏π 1</th>
                <th class="score-cell" style="width: 100px;">‡∏Ñ‡∏£‡∏π 2</th>
                <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (Feedback)</th>
              </tr>
            </thead>
            <tbody id="feedbackTable">
              <tr><td colspan="5" style="text-align:center;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
            </tbody>
          </table>
        `;

        // ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
        document.getElementById("studentId").textContent = data.student_id || "-";
        document.getElementById("groupId").textContent = data.group_id || "-";
        document.getElementById("examYear").textContent = data.exam_year || "-";
        const statusElement = document.getElementById("status");
        statusElement.textContent = data.status || "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏ß‡∏à";
        statusElement.className = "status " + (data.status === '‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß' ? 'checked' : 'unchecked');
        document.getElementById("totalScoreAI").textContent = data.score != null ? data.score.toFixed(1) : "0";
        document.getElementById("essayText").textContent = data.essay_text || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        document.getElementById("essayAnalysis").textContent = data.essay_analysis || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";

        // ========== ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON ==========
        let parsedDescription = {};
        try {
          if (data.description) {
            parsedDescription = typeof data.description === 'string' ? JSON.parse(data.description) : data.description;
          }
          console.log("‚úÖ Parsed description:", parsedDescription);
        } catch (e) {
          console.error("‚ùå Error parsing description:", e);
        }

        let teacherScores = {};
        try {
          if (data.teacher_scores) {
            teacherScores = typeof data.teacher_scores === 'string' ? JSON.parse(data.teacher_scores) : data.teacher_scores;
          }
          console.log("‚úÖ Parsed teacherScores:", teacherScores);
        } catch (e) {
          console.error("‚ùå Error parsing teacher_scores:", e);
        }

        // ========== ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á ==========
        const feedbackTable = document.getElementById("feedbackTable");
        feedbackTable.innerHTML = ""; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏Å‡πà‡∏≤

        const criteriaOrder = [
          { type: 'header', text: '--- ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 1: ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏¢‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô) ---' },
          "s1", "s2", "s3", "s4", "s5", "s6",
          { type: 'summary', part: 1 },
          { type: 'header', text: '--- ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 2: ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô (20 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô) ---' },
          "s7", "s8", "s9", "s10", "s11", "s12", "s13",
          { type: 'summary', part: 2 }
        ];

        const criteriaNameMapping = {
          s1: '‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (4 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)',
          s2: '‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î (2 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)',
          s3: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏¢‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)',
          s4: '‡∏Å‡∏≤‡∏£‡∏™‡∏∞‡∏Å‡∏î‡∏Ñ‡∏≥ (1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)',
          s5: '‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥/‡∏ñ‡πâ‡∏≠‡∏¢‡∏Ñ‡∏≥‡∏™‡∏≥‡∏ô‡∏ß‡∏ô (1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)',
          s6: '‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ (1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)',
          s7: '‡∏Ñ‡∏≥‡∏ö‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô (2 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)',
          s8: '‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô (5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)',
          s9: '‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î (1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)',
          s10: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô (1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)',
          s11: '‡∏Å‡∏≤‡∏£‡∏™‡∏∞‡∏Å‡∏î‡∏Ñ‡∏≥/‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤ (1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)',
          s12: '‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥/‡∏ñ‡πâ‡∏≠‡∏¢‡∏Ñ‡∏≥‡∏™‡∏≥‡∏ô‡∏ß‡∏ô (1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)',
          s13: '‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ (1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)',
        };

        let totals = {
          ai: { part1: 0, part2: 0 },
          teacher1: { part1: 0, part2: 0 },
          teacher2: { part1: 0, part2: 0 }
        };

        criteriaOrder.forEach(item => {
          if (typeof item === 'object') {
            if (item.type === 'header') {
              const headerRow = document.createElement("tr");
              headerRow.innerHTML = `<td colspan="5" style="background-color: #e9ecef; font-weight: bold; text-align: center;">${item.text}</td>`;
              feedbackTable.appendChild(headerRow);
            } else if (item.type === 'summary') {
              const part = `part${item.part}`;
              const summaryRow = document.createElement("tr");
              summaryRow.style.background = "#f0f8ff";
              summaryRow.style.fontWeight = "bold";
              summaryRow.innerHTML = `
                    <td>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${item.part}</td>
                    <td class="score-cell score-ai">${totals.ai[part].toFixed(1)}</td>
                    <td class="score-cell score-teacher">${totals.teacher1[part] > 0 ? totals.teacher1[part].toFixed(1) : '-'}</td>
                    <td class="score-cell score-teacher">${totals.teacher2[part] > 0 ? totals.teacher2[part].toFixed(1) : '-'}</td>
                    <td>-</td>
                `;
              feedbackTable.appendChild(summaryRow);
            }
            return;
          }

          const sKey = item;
          const criteriaData = parsedDescription[sKey];

          if (criteriaData) {
            const criteriaName = criteriaNameMapping[sKey] || sKey;
            const aiScore = parseFloat(criteriaData.score ?? 0);

            const part = parseInt(sKey.substring(1)) <= 6 ? 'part1' : 'part2';
            totals.ai[part] += aiScore;

            const t1ScoreStr = teacherScores?.teacher1?.[sKey];
            const t2ScoreStr = teacherScores?.teacher2?.[sKey];
            const teacher1 = t1ScoreStr != null && t1ScoreStr !== '' ? parseFloat(t1ScoreStr).toFixed(1) : "-";
            const teacher2 = t2ScoreStr != null && t2ScoreStr !== '' ? parseFloat(t2ScoreStr).toFixed(1) : "-";

            if (teacher1 !== '-') totals.teacher1[part] += parseFloat(teacher1);
            if (teacher2 !== '-') totals.teacher2[part] += parseFloat(teacher2);

            let details = "-";
            if (criteriaData.feedback) {
              try {
                const feedbackObj = JSON.parse(criteriaData.feedback);
                details = JSON.stringify(feedbackObj, null, 2);
              } catch (e) {
                details = criteriaData.feedback;
              }
            }

            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${criteriaName}</td>
                <td class="score-cell score-ai">${aiScore.toFixed(1)}</td>
                <td class="score-cell score-teacher">${teacher1}</td>
                <td class="score-cell score-teacher">${teacher2}</td>
                <td><pre>${details}</pre></td>
            `;
            feedbackTable.appendChild(row);
          } else {
            console.warn(`‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏ì‡∏ë‡πå: ${sKey}`);
          }
        });

      } catch (error) {
        console.error("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", error);
        showError("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", error.message || "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ");
      }
    }
  </script>
</body>

</html>
